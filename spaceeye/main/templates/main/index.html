{% extends 'main/base.html' %}

{% block title %}APOD - NASA Explorer{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">Astronomy Picture of the Day</h1>
        
        <!-- Date Selector -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Select Date</h5>
                <form method="get" class="row g-3">
                    <div class="col-md-6">
                        <label for="date-picker" class="form-label">Pick any date:</label>
                        <div class="input-group">
                            <input type="date" name="date" id="date-picker" class="form-control" 
                                   value="{{ selected_date|default:'' }}" 
                                   max="{% now 'Y-m-d' %}" 
                                   min="1995-06-16">
                            <button type="submit" class="btn btn-primary">Go</button>
                        </div>
                        <small class="form-text text-muted">Available since June 16, 1995</small>
                    </div>
                </form>
            </div>
        </div>

        <!-- APOD Content -->
        <div id="apod-content">
            {% if nasa_data.error %}
                <div class="alert alert-warning">
                    <h4>‚ö†Ô∏è {{ nasa_data.error }}</h4>
                    <p>Please try selecting a different date. Some dates may not have images available.</p>
                </div>
            {% else %}
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-8">
                                {% if nasa_data.media_type == 'image' %}
                                    <div class="image-container mb-3">
                                        <img src="{{ nasa_data.url }}" 
                                             alt="{{ nasa_data.title }}" 
                                             class="img-fluid"
                                             loading="lazy">
                                    </div>
                                {% elif nasa_data.media_type == 'video' %}
                                    <div class="ratio ratio-16x9 mb-3">
                                        <iframe src="{{ nasa_data.url }}" 
                                                allowfullscreen
                                                title="{{ nasa_data.title }}">
                                        </iframe>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-lg-4">
                                <h2 class="card-title">{{ nasa_data.title }}</h2>
                                <p class="text-muted mb-3">
                                    <strong>üìÖ {{ nasa_data.date }}</strong>
                                </p>
                                
                                {% if nasa_data.media_type == 'image' and nasa_data.hdurl %}
                                    <div class="mb-3">
                                        <a href="{{ nasa_data.hdurl }}" 
                                           target="_blank" 
                                           class="btn btn-primary">
                                            üîç View HD Version
                                        </a>
                                    </div>
                                {% endif %}
                                
                                <div class="mb-3">
                                    <h6>Description:</h6>
                                    <p class="card-text">{{ nasa_data.explanation }}</p>
                                </div>
                                
                                {% if nasa_data.copyright %}
                                    <p class="text-muted">
                                        <small><strong>¬©</strong> {{ nasa_data.copyright }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º
function navigateDate(days) {
    const currentDate = new Date('{{ selected_date|default:"" }}' || new Date());
    currentDate.setDate(currentDate.getDate() + days);
    
    const minDate = new Date('1995-06-16');
    const maxDate = new Date();
    
    if (currentDate >= minDate && currentDate <= maxDate) {
        const dateString = currentDate.toISOString().split('T')[0];
        window.location.href = `?date=${dateString}`;
    }
}

// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
document.addEventListener('DOMContentLoaded', function() {
    const cardBody = document.querySelector('#apod-content .card-body');
    if (cardBody && !document.querySelector('.date-navigation')) {
        const nav = document.createElement('div');
        nav.className = 'date-navigation text-center mt-3';
        nav.innerHTML = `
            <button class="btn btn-outline-light btn-sm me-2" onclick="navigateDate(-1)">
                ‚Üê Previous Day
            </button>
            <button class="btn btn-outline-light btn-sm" onclick="navigateDate(1)">
                Next Day ‚Üí
            </button>
        `;
        cardBody.appendChild(nav);
    }
});
</script>
{% endblock %}